(function(n,r){typeof exports=="object"&&typeof module<"u"?r(exports,require("@mahdikhashan/vue3-click-outside"),require("vue")):typeof define=="function"&&define.amd?define(["exports","@mahdikhashan/vue3-click-outside","vue"],r):(n=typeof globalThis<"u"?globalThis:n||self,r(n["vue-context"]={},n.vClickOutside,n.Vue))})(this,function(n,r,c){"use strict";Array.from||(Array.from=e=>[].slice.call(e)),Array.isArray||(Array.isArray=e=>Object.prototype.toString.call(e)==="[object Array]");const y=Array.from,b=Array.isArray,u={ESC:27,LEFT:37,UP:38,RIGHT:39,DOWN:40},E=(e,t)=>!e||typeof e.contains!="function"?!1:e.contains(t),a=(e,t,s)=>{e&&e.addEventListener&&e.addEventListener(t,s)},f=(e,t,s)=>{e&&e.removeEventListener&&e.removeEventListener(t,s)},g=e=>(e||[]).filter(w),v=e=>h(e)?e.getBoundingClientRect():null,h=e=>!!(e&&e.nodeType===Node.ELEMENT_NODE),w=e=>{if(!h(e)||!E(document.body,e)||e.style.display==="none")return!1;const t=v(e);return!!(t&&t.height>0&&t.width>0)},m=(e,t)=>y((h(t)?t:document).querySelectorAll(e)),p=(e,t,s)=>{t&&h(e)&&e.setAttribute(t,s)},o=(e,t)=>{let s=e.parentElement;for(;s!==null&&!s.classList.contains(t);)s=s.parentElement;return s},x={directives:{clickOutside:r.directive},props:{closeOnClick:{type:Boolean,default:!0},closeOnScroll:{type:Boolean,default:!0},lazy:{type:Boolean,default:!1},itemSelector:{type:[String,Array],default:()=>[".v-context-item",".v-context > li > a"]},role:{type:String,default:"menu"},subMenuOffset:{type:Number,default:10},useScrollHeight:{type:Boolean,default:!1},useScrollWidth:{type:Boolean,default:!1},heightOffset:{type:Number,default:25},widthOffset:{type:Number,default:25},tag:{type:String,default:"ul"}},computed:{style(){return this.show?{top:`${this.top}px`,left:`${this.left}px`}:null}},data(){return{top:null,left:null,show:!1,data:null,localItemSelector:"",activeSubMenu:null}},created(){this.localItemSelector=this.mapItemSelector(this.itemSelector)},beforeDestroy(){this.closeOnScroll&&this.removeScrollEventListener()},methods:{addScrollEventListener(){a(window,"scroll",this.close)},addHoverEventListener(e){e.querySelectorAll(".v-context__sub").forEach(t=>{a(t,"mouseenter",this.openSubMenu),a(t,"mouseleave",this.closeSubMenu)})},close(){if(this.show){for(;this.activeSubMenu!==null;)o(this.activeSubMenu,"v-context__sub").dispatchEvent(new Event("mouseleave"));this.resetData(),this.removeHoverEventListener(this.$el),this.closeOnScroll&&this.removeScrollEventListener(),this.$emit("close")}},focusItem(e,t){const s=t.find((i,l)=>l===e);s&&s.focus()},focusNext(e,t){this.show&&(e.preventDefault(),e.stopPropagation(),this.$nextTick(()=>{const s=this.getItems();if(s.length<1)return;let i=s.indexOf(e.target);t&&i>0?i--:!t&&i<s.length-1&&i++,i<0&&(i=0),this.focusItem(i,s)}))},getItems(){return g(m(this.localItemSelector,this.activeSubMenu||this.$el))},mapItemSelector(e){return b(e)&&(e=e.map(t=>`${t}:not(.disabled):not([disabled])`).join(", ")),e},onClick(){this.close()},onKeydown(e){const t=e.keyCode;if(t===u.ESC)this.close();else if(t===u.DOWN)this.focusNext(e,!1);else if(t===u.UP)this.focusNext(e,!0);else if(t===u.RIGHT){const s=o(e.target,"v-context__sub");s&&s.getElementsByClassName("v-context")[0]!==this.activeSubMenu&&(s.dispatchEvent(new Event("mouseenter")),this.focusNext(e,!1))}else if(t===u.LEFT){if(!this.activeSubMenu)return;const s=o(this.activeSubMenu,"v-context__sub");s.dispatchEvent(new Event("mouseleave"));const i=this.getItems(),l=i.indexOf(s.getElementsByTagName("a")[0]);this.focusItem(l,i)}},open(e,t){this.data=t,this.show=!0,this.$nextTick(()=>{[this.top,this.left]=this.positionMenu(e.clientY,e.clientX,this.$el),this.$el.focus(),this.setItemRoles(),this.addHoverEventListener(this.$el),this.closeOnScroll&&this.addScrollEventListener(),this.$emit("open",e,this.data,this.top,this.left)})},openSubMenu(e){const t=this.getSubMenuElementByEvent(e),s=o(t.parentElement,"v-context"),i=v(e.target);if(this.activeSubMenu!==s)for(;this.activeSubMenu!==null&&this.activeSubMenu!==s&&this.activeSubMenu!==t;)o(this.activeSubMenu,"v-context__sub").dispatchEvent(new Event("mouseleave"));t.style.display="block";let[l,d]=this.positionMenu(i.top,i.right-this.subMenuOffset,t);t.style.left=`${d}px`,t.style.top=`${l}px`,this.activeSubMenu=t},closeSubMenu(e){const t=this.getSubMenuElementByEvent(e),s=o(t,"v-context");if(this.activeSubMenu!==t)for(;this.activeSubMenu!==null&&this.activeSubMenu!==t;)o(this.activeSubMenu,"v-context__sub").dispatchEvent(new Event("mouseleave"));t.style.display="none",this.activeSubMenu=s&&o(s,"v-context__sub")?s:null},getSubMenuElementByEvent(e){return e.target.getElementsByTagName("ul")[0]},positionMenu(e,t,s){const i=this.useScrollHeight?s.scrollHeight:s.offsetHeight,l=window.innerHeight-i-this.heightOffset,d=this.useScrollWidth?s.scrollWidth:s.offsetWidth,S=window.innerWidth-d-this.widthOffset;return e>l&&(e=l),t>S&&(t=S),[e,t]},removeScrollEventListener(){f(window,"scroll",this.close)},removeHoverEventListener(e){e.querySelectorAll(".v-context__sub").forEach(t=>{f(t,"mouseenter",this.openSubMenu),f(t,"mouseleave",this.closeSubMenu)})},resetData(){this.top=null,this.left=null,this.data=null,this.show=!1},setItemRoles(){m(this.localItemSelector,this.$el).forEach(e=>{p(e,"role","menuitem"),p(e,"tabindex","-1")})}},watch:{closeOnScroll(e,t){e!==t&&(e&&this.show?this.addScrollEventListener():this.removeScrollEventListener())},itemSelector(e,t){e!==t&&(this.localItemSelector=this.mapItemSelector(e))}},render(){if(this.lazy&&!this.show)return c.h(!1);this.onKeydown,this.closeOnClick&&this.onClick;const e=[[c.vShow,this.show],[r,this.close]],t=c.h(this.tag,{class:"v-context",style:this.show?{top:`${this.top}px`,left:`${this.left}px`}:null,tabindex:"-1",role:this.role,"aria-hidden":this.lazy?null:String(!this.show),on:{contextmenu:s=>{s.preventDefault()},keydown:this.onKeydown}},this.$slots.default({data:this.data}));return c.withDirectives(t,e)}};n.default=x,Object.defineProperties(n,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
